<div *ngIf="roomError$ | async; then error; else chatRoom"></div>

<nz-alert *ngIf="loggedInUserIsLeader$ | async"  nzBanner nzType="info"  nzIconType="interaction" nzShowIcon nzCloseable="false" [nzMessage]="youAreLeaderText">
</nz-alert>

<ng-template #chatRoom>

  <div class="wrapper">
    <div class="header">
      <h5 nz-typography>
        {{ name }}
      </h5>
    </div>
    <div class="feed"  #feed>
      <div *ngFor="let message of messages$ | async; last as isLast;">

        <p nz-typography class="message">
          <ng-container *ngIf="!message.isSystemMessage; then username; else system;"></ng-container>
          <ng-container *ngIf="!message.isSystemMessage; else systemMessage;">
            {{ message.text }}
          </ng-container>          

          <ng-template #systemMessage>
            <span nz-typography><small>{{ message.text }}</small></span>
          </ng-template>

          <ng-template #username>
            <span nz-typography><code>{{ message.username }}</code></span>
          </ng-template>

          <ng-template #system>
            <span nz-typography><code><i nz-icon nzType="robot" nzTheme="outline" nz-tooltip nzTooltipTitle="Message from server"></i></code></span>
          </ng-template>
        </p>
      </div>
    </div>
    <div class="input">
      <textarea placeholder="Send a message..." [(ngModel)]="msgBoxValue" name="textarea"
        (keyup.enter)="submitPressedSubject.next({ text:msgBoxValue, ev: $event })">
        </textarea>
    </div>
  </div>
</ng-template>

<ng-template #error>

  <p *ngIf="roomError$ | async">Error joining room..</p>

</ng-template>
 
<ng-template #youAreLeaderText>
  <span nz-typography nz-tooltip nzTooltipTitle="Being a leader means your media player state is sent to the other members of the room, enabling synchronized playback across member's devices. Everyone in the room is now hooked into your playback! Switch videos or seek in the media to try it out">You are the leader</span>
</ng-template>
