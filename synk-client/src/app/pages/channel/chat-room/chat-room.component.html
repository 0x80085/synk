<div *ngIf="roomError$ | async; then error; else chatRoom"></div>

<nz-alert *ngIf="loggedInUserIsLeader$ | async"  nzBanner nzType="info"  nzIconType="interaction" nzShowIcon nzCloseable="false" [nzMessage]="youAreLeaderText">
</nz-alert>

<ng-template #chatRoom>

  <div class="wrapper">
    <div class="header">
      <h5 nz-typography>
        {{ name }}
      </h5>
    </div>
    <div class="feed"  #feed>
      <div *ngFor="let message of messages$ | async; last as isLast;">

        <app-chat-message [message]="message"></app-chat-message>

        <!-- <p nz-typography class="message">
          <ng-container *ngIf="!message.isSystemMessage; then username; else system;"></ng-container>
          <ng-container *ngIf="!message.isSystemMessage; else systemMessage;">
            {{ message.text }}
            <span [innerHTML]="message.parsedText"></span>
          </ng-container>

          <ng-template #systemMessage>
            <span nz-typography><small>{{ message.text }}</small></span>
          </ng-template>

          <ng-template #username>
            <span nz-typography><code>{{ message.username }}</code></span>
          </ng-template>

          <ng-template #system>
            <span nz-typography><code><i nz-icon nzType="robot" nzTheme="outline" nz-tooltip nzTooltipTitle="Message from server"></i></code></span>
          </ng-template>
        </p> -->
      </div>
    </div>
    <app-message-input (submitMessage)="submitPressedSubject.next({ text:$event, ev: $event })"></app-message-input>
  </div>
</ng-template>

<ng-template #error>
  <p *ngIf="roomError$ | async">Error joining room..</p>
</ng-template>

<ng-template #youAreLeaderText>
  <span nz-typography nz-tooltip nzTooltipTitle="Being a leader means your media player state is sent to other members of the room, enabling synchronized playback across member's devices. Everyone in the room is now hooked into your playback! Start playing a video to try it out">You are the leader</span>
</ng-template>
