<p>Channel: {{ name }}</p>

<div *ngIf="!(errorEvent$ | async); then channelStage; else errorConnecting"></div>

<ng-template #channelStage>
  <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32, xl: 32, xxl: 32 }">
    <div nz-col nzSpan="6" class="column gutter-row">
      <app-chat-room [name]="name"></app-chat-room>
    </div>
    <div nz-col nzSpan="18" class="column gutter-row">
      <app-media #player (mediaEndedEvent)="onVideoEnded()"></app-media>
    </div>
    <div nz-col nzSpan="6" class="mt-1">

      <nz-list [nzBordered]="(members$  | async)" nzSize="small" [nzLoading]="!(members$  | async)"
        [nzDataSource]="members$ | async" [nzRenderItem]="member" [nzNoResult]="'No items'">
        <ng-template #member let-member>
          <nz-list-item [nzActions]="[giveLeaderBtn]">
            <nz-list-item-meta [nzTitle]="nzTitle" [nzAvatar]="member.isLeader ? leaderIcon : null"
              [nzDescription]="member.userName">
              <ng-template #nzTitle>
                <span>{{ member.userName }}</span>
              </ng-template>
            </nz-list-item-meta>
          </nz-list-item>
          <ng-template #leaderIcon>
            <i nz-icon style="color: white; font-size: 1rem;" nzType="crown" nz-tooltip
              nzTitle="This user currently controls the playback"></i>
          </ng-template>
          <ng-template #giveLeaderBtn>
            <button nz-button nzType="link" nz-tooltip nzTitle="Hand over playback control to user" (click)="giveLeader(member)">
              <i nz-icon nzType="api"></i>
            </button>
          </ng-template>
        </ng-template>
      </nz-list>
    </div>
    <div nz-col nzSpan="18" class="mt-1">
      <app-playlist [playlist$]="playlist$" [activeItem]="activeItemSubject" [roomName]="name" [showAddMediaInput]="isLeader"
        (playMedia)="player.play($event.mediaUrl)">
      </app-playlist>
    </div>
  </div>
</ng-template>

<ng-template #disconnectedImg>
  <i nz-icon style="font-size: 5rem; color: rgb(204, 254, 253);" nzType="frown"></i>
</ng-template>
<ng-template #errorConnecting>
  <div nz-col nzSpan="24" class="column">
    <nz-empty [nzNotFoundImage]="disconnectedImg" nzNotFoundContent="Can't connect to channel. Try logging in?">
    </nz-empty>
  </div>
</ng-template>
